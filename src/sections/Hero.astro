---
interface Banner {
  title: string;
  subtitle: string;
  image: string;
}

const banners: Banner[] = [
  { title: "Baterías Star Redesign", subtitle: "Web Design", image: "/Hero-2.webp" },
  { title: "Kaede Branding Concept", subtitle: "Visual Identity", image: "/Hero.webp" },
  { title: "UI / UX Exploration", subtitle: "Design Systems", image: "/Hero-2.webp" },
];
---

<main
  id="hero"
  class="hero-section relative top-[20px] w-[calc(100%-40px)] mx-auto min-h-[95vh] text-white rounded-lg overflow-hidden"
>
  {banners.map((banner, index) => (
    <section
      class={`hero-slide absolute inset-0 flex flex-col justify-end px-10 py-20 transition-opacity duration-[1200ms] ease-in-out ${
        index === 0 ? "opacity-100" : "opacity-0"
      }`}
      data-index={index}
    >
      <!-- Fondo con imagen -->
      <div class="hero-bg absolute inset-0">
        <img
          src={banner.image}
          alt={banner.title}
          class={`hero-bg-img transition-transform duration-[2000ms] ease-out ${
            index === 0 ? "opacity-100 scale-100" : "opacity-0 scale-110"
          }`}
          loading={index === 0 ? "eager" : "lazy"}
        />
      </div>

      <!-- Contenido -->
      <div class="text-hero relative z-10 opacity-0 transition-none">
        <p class="text-white/80 max-w-lg text-left tracking-tight">{banner.subtitle}</p>
        <h1 class="text-4xl mb-4 tracking-tight">{banner.title}</h1>
        <button
          class="hero-cta transition duration-700 px-5 py-[5px] rounded-lg text-[13px] tracking-tight"
        >
          View more about
        </button>
      </div>
    </section>
  ))}
</main>

<style>
  /* ==== BASE ==== */
  .hero-section {
    position: relative;
    background-color: black;
    overflow: hidden;
    border-radius: 0.75rem;
    top: 20px;
    width: calc(100% - 40px);
    min-height: 95vh;
    margin-left: auto;
    margin-right: auto;
  }

  .hero-slide {
    background: transparent;
    border-radius: 0.5rem;
    pointer-events: none;
  }

  .hero-slide.opacity-100 {
    pointer-events: auto;
  }

  /* ==== FONDO ==== */
  .hero-bg {
    position: absolute;
    inset: 0;
    overflow: hidden;
    z-index: 0;
  }

  .hero-bg-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    transform-origin: center;
    display: block;
    will-change: transform, opacity;
  }

  /* ==== ANIMACIÓN TEXTO ==== */
  @keyframes fadeInUp {
    0% { opacity: 0; transform: translateY(20px); }
    100% { opacity: 1; transform: translateY(0); }
  }

  .text-active {
    animation: fadeInUp 1.2s ease-out forwards;
  }

  /* ==== BOTÓN ==== */
  .hero-cta {
    background: rgba(77, 77, 77, 0.6);
    color: white;
    border: none;
  }

  .hero-cta:hover {
    background: rgba(255, 255, 255, 0.95);
    color: black;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const slides = Array.from(document.querySelectorAll(".hero-slide"));
    const hero = document.getElementById("hero");
    let current = 0;

    // ======== Slider ========
    function showNext() {
      const prev = slides[current];
      const nextIndex = (current + 1) % slides.length;
      const next = slides[nextIndex];

      const prevImg = prev.querySelector(".hero-bg-img");
      const nextImg = next.querySelector(".hero-bg-img");
      const prevText = prev.querySelector(".text-hero");
      const nextText = next.querySelector(".text-hero");

      if (prevText) {
        prevText.style.opacity = "0";
        prevText.classList.remove("text-active");
      }

      prev.classList.replace("opacity-100", "opacity-0");
      prevImg.classList.add("scale-110", "opacity-0");

      next.classList.replace("opacity-0", "opacity-100");
      nextImg.classList.remove("scale-110", "opacity-0");

      if (nextText) {
        nextText.style.opacity = "1";
        void nextText.offsetWidth;
        nextText.classList.add("text-active");
      }

      current = nextIndex;
    }

    // Estado inicial
    const firstSlide = slides[current];
    firstSlide.querySelector(".hero-bg-img")?.classList.add("scale-100", "opacity-100");
    const firstText = firstSlide.querySelector(".text-hero");
    if (firstText) {
      firstText.style.opacity = "1";
      firstText.classList.add("text-active");
    }

    // Rotación automática
    setInterval(showNext, 6000);

    // ======== Efecto scroll proporcional ========
    let lastProgress = 0; // para interpolar suavemente
    window.addEventListener("scroll", () => {
      const scrollY = window.scrollY;
      const start = 300; // el scroll donde comienza el efecto
      const end = 600; // el scroll donde termina el efecto
      const rawProgress = Math.min(Math.max((scrollY - start) / (end - start), 0), 1);

      // Suaviza con un easing (ease-out)
      const progress = 1 - Math.pow(1 - rawProgress, 3);

      // Interpolación
      const smoothProgress = lastProgress + (progress - lastProgress) * 0.2;
      lastProgress = smoothProgress;

      const top = 20 * (1 - smoothProgress);
      const minHeight = 95 + 5 * smoothProgress;
      const borderRadius = 0.75 * (1 - smoothProgress);

      hero.style.top = `${top}px`;
      hero.style.width = `calc(100% - ${40 * (1 - smoothProgress)}px)`;
      hero.style.minHeight = `${minHeight}vh`;
      hero.style.borderRadius = `${borderRadius}rem`;
    });
  });
</script>

